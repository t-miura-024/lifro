# 要件定義

## 機能要件

### ログ機能
- ユーザーが筋トレの成果を入力できる。
  - 種目
  - 重量
  - レップ数
- 種目、重量、レップ数をまとめてセットとして入力できる。
  - 入力前は前回の入力値を表示する。
  - 入力後は前回の入力値との差分を表示する。
  - 種目名は登録済みの種目からプルダウンで選択できる。
- トレーニングの概念
  - トレーニングはセットを日単位でまとめた概念であり、セットの二次情報である。
  - 複数のセットが同じ日に行われた場合、それらは同一のトレーニングとして扱われる。
- トレーニング（セットのグループ）を日付で入力できる。
  - カレンダーから日付を選択できる。
  - 過去の日付にさかのぼって入力できる。
- 入力済みログの管理
  - 記録の編集・削除ができる。
- トレーニングメモ
  - トレーニング（日単位）に対して複数のメモを入力できる。
  - メモはログ作成・編集画面で入力・編集・削除できる。
  - ログ一覧画面ではメモの有無がアイコンで表示される。
  - アイコンをクリックするとポップオーバーでメモ内容を確認できる。
- 前回値・差分の定義
  - 前回値は「前回のトレーニング（前回の日付）における同一種目の最後のセットの重量・レップ数」とする。
  - 差分は、現在入力中のセット値と前回値との差（重量・レップ数ごと）を表示する。

### 種目管理機能
- ユーザーが種目情報を管理できる。
  - 種目の一覧表示ができる。
  - 種目の新規作成ができる。
  - 種目名の編集ができる。
  - 種目の削除ができる。
    - トレーニング記録が紐づいている種目は削除できない。
  - 種目の並び順をドラッグ&ドロップで変更できる。
    - 並び順はログ入力時の種目選択プルダウンに反映される。

### 統計機能
- 入力された筋トレの成果をグラフィカルに表示するダッシュボードを提供する。
- 画面構成
  - タブ切り替え（ボリューム / 重量 / 継続）で指標を整理する。
  - グローバルフィルターで全タブ共通の時間粒度・時間範囲を指定できる。
- グローバルフィルター
  - 時間粒度: 日 / 週 / 月をトグルボタンで切り替える。
  - 時間範囲: プリセット（過去1ヶ月 / 3ヶ月 / 6ヶ月 / 1年 / 全期間）またはカスタム日付を選択できる。
- ボリュームタブ
  - KPIカード: 選択期間の合計ボリューム（全種目）を表示する。
  - 種目別リスト: 種目ごとの合計ボリュームをリスト形式で表示する（ボリューム降順）。
  - 推移グラフ: 積み上げ棒グラフで種目別に色分けし、ホバー時にセット数を表示する。
- 重量タブ
  - 最大重量グラフ: 種目を選択し、棒グラフで期間ごとの最大重量を表示する。
  - 1RMグラフ: 種目を選択し、棒グラフで期間ごとの推定1RMを表示する。
- 継続タブ
  - KPIカード: 合計トレーニング日数 / 連続継続月数 / 連続継続週数を表示する。
  - 推移グラフ: 棒グラフで期間ごとのトレーニング日数を表示する。
  - 種目別リスト: 種目ごとのトレーニング日数をリスト形式で表示する（日数降順）。
- 指標の定義
  - ボリューム = weight × reps（セット単位で計算し合算）
  - 最大重量 = 指定期間内の各種目のセット重量の最大値
  - 1RM = 最大重量 × (1 + レップ数 / 29.5)
  - 連続継続月数 = 1回以上トレーニング記録がある月が連続している月数（未記録月でリセット）
  - 連続継続週数 = 1回以上トレーニング記録がある週が連続している週数（未記録週でリセット）

### 認証機能
- Googleアカウントを利用した認証機能を提供する。
  - ユーザーがGoogleアカウントでログインできるようにする。
  - ログイン状態を維持できる。
  - ログアウト機能を提供する。

## 非機能要件

### ユーザビリティ
- シンプルで直感的なUIを提供し、ユーザーが迷わずに操作できるようにする。
  - 重要な機能へのアクセスは3タップ以内で可能にする。
  - 入力フォームは自動補完機能を備える。
  - エラーメッセージは具体的で分かりやすい内容にする。
- ローディング表示はスケルトンローディングで統一する。
  - データ取得中はコンテンツの形状に合わせたスケルトンを表示し、レイアウトシフトを防止する。
  - ユーザーがコンテンツの構造を予測でき、体感待ち時間を短縮する。
- モバイルデバイスでも快適に操作できるレスポンシブデザインを採用する。
  - 標準画面は Pixel 9（1080×2424）。論理解像度約 411×915dp を基準に最適化する。
  - ビューポートは `width=device-width, initial-scale=1, viewport-fit=cover` を設定する。
  - タッチターゲットは 44dp 以上とする（ボタン、アイコンボタン）。
  - 片手操作（親指リーチ）を考慮し、主要アクションは画面下部または右上に配置する。
  - セーフエリア（ノッチ/ホームインジケータ）を考慮し、`100dvh` とパディングで吸収する。
- トレーニング中の片手操作に対応したUIを提供する。
  - 大きなボタンやスワイプ操作など、トレーニング中でも操作しやすい設計にする。

### セキュリティ
- ユーザーのデータを安全に保存し、第三者からの不正アクセスを防ぐ。
  - すべての通信はHTTPS経由で行う。
  - 個人情報は適切に暗号化して保存する。
- ユーザー認証機能を実装し、データのプライバシーを保護する。
  - 認証トークンの有効期限を適切に設定する。
  - セッション管理を適切に行い、不正なアクセスを防止する。

### パフォーマンス
- 参照系データはRedisキャッシュ（TTL 5分）で高速化する。
- データ更新時は関連キャッシュを自動的に無効化し、データ整合性を保証する。
