# アーキテクチャ設計

## 全体アーキテクチャ
本システムはNext.jsを採用したモノリシックなアプリケーションとして構築します。
Next.jsのApp Routerを活用し、SSR（Server-Side Rendering）とCSRを適切に使い分けることで、
パフォーマンスと開発効率の両立を図ります。

## フロントエンド
フロントエンドはコロケーションパターンを採用します。コンポーネントとそれに関連するロジック・スタイルを
同じディレクトリに配置することで、関連する機能の保守性を高めます。
全てのコンポーネントはapp配下に配置し、機能固有のコンポーネントはその機能のディレクトリに配置します。
コンポーネントは全て_componentsという名前のプライベートディレクトリに配置します。

### ディレクトリ構成
```
app/
├── _components/             # アプリケーション全体で共通のコンポーネント
├── api/                     # API Routes (Route Handlers)
│   └── trpc/                # tRPC API エンドポイント
├── (public)/                # 未認証でもアクセス可能なルートグループ
│   ├── _components/         # 公開画面共通のコンポーネント
│   ├── login/               # ログイン画面
│   │   ├── _components/     # ログイン画面専用コンポーネント
│   │   └── page.tsx         # ログインページコンポーネント
│   └── layout.tsx           # 公開ページの共通レイアウト
├── (authenticated)/         # 認証が必要なルートグループ
│   ├── _components/         # 認証済みページ共通のコンポーネント
│   ├── logs/                # ログ管理画面
│   │   ├── _components/     # ログ管理画面専用コンポーネント
│   │   └── page.tsx         # ログ管理ページコンポーネント
│   ├── statistics/          # 統計ダッシュボード画面
│   │   ├── _components/     # 統計画面専用コンポーネント
│   │   └── page.tsx         # 統計ページコンポーネント
│   ├── settings/            # ユーザー設定画面
│   │   ├── _components/     # 設定画面専用コンポーネント
│   │   └── page.tsx         # 設定ページコンポーネント
│   └── layout.tsx           # 認証済みページの共通レイアウト
├── lib/                     # ユーティリティ関数など
│   ├── trpc/                # tRPC設定
│   └── auth/                # 認証関連ユーティリティ
└── providers/               # コンテキストプロバイダーなど
```

## バックエンド
バックエンドはレイヤードアーキテクチャを採用します。
ただし、Infrastructure層とApplication層間の依存はDIにより依存性を逆転させることとします。
プレゼンテーション層はapp/api配下のRoute Handlersが担当するため、サーバーサイドのディレクトリ構成には含めません。

### ディレクトリ構成
```
server/
├── application/            # アプリケーション層
│   ├── services/           # ドメインサービス
│   └── usecases/           # ユースケース
├── domain/                 # ドメイン層
│   ├── entities/           # エンティティ
│   ├── repositories/       # リポジトリインターフェース
│   └── valueObjects/       # 値オブジェクト
├── infrastructure/         # インフラストラクチャ層
│   ├── database/           # データベース関連
│   │   ├── prisma/         # Prisma関連
│   │   └── repositories/   # リポジトリ実装
│   └── services/           # 外部サービス連携
└── di/                     # 依存性注入設定
```
